---
import SidebarHeader from '../components/SidebarHeader.astro'
import MenuItem from '../components/MenuItem.astro'
---

<div class="sidebar-container collapsed">
  <button class="sidebar-toggle" id="sidebar-toggle">☰</button>
  <nav class="sidebar" id="sidebar">
    <SidebarHeader />
    <ul class="sidebar-menu">
      <MenuItem href="/" icon="mdi:home" text="Dashboard" isActive={true} />
      <MenuItem href="/nivel_agua" icon="mdi:water" text="Nivel de Agua" />
      <MenuItem href="/temperatura" icon="mdi:temperature" text="Temperatura" />
      <MenuItem href="/humedad" icon="mdi:humidity-alert" text="Humedad" />
      <MenuItem href="/luz" icon="mdi:white-balance-sunny" text="Luz" />
      <MenuItem href="/mantenimiento" icon="mdi:build" text="Mantenimiento" />
      <MenuItem href="/configuracion" icon="mdi:settings" text="Configuración" />
      <li class="logout-item">
        <MenuItem href="/cerrar-sesion" icon="mdi:logout" text="Cerrar sesión" />
      </li>
    </ul>
  </nav>
</div>

<div class="main-content" id="main-content">
  <!-- Aquí va el contenido principal de la página -->
</div>

<style>
  .sidebar-container {
    position: relative;
  }

  .sidebar-toggle {
    background-color: var(--sidebar-bg);
    color: var(--sidebar-text);
    border: none;
    padding: 1rem;
    cursor: pointer;
    position: fixed;
    top: 10px;
    left: 10px;
    z-index: 1000;
  }

  .sidebar {
    width: 250px;
    height: 100vh;
    background-color: var(--sidebar-bg);
    color: var(--sidebar-text);
    position: fixed;
    top: 0;
    left: -250px;
    transition: left 0.3s;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
  }

  .sidebar.open {
    left: 0;
  }

  .sidebar-menu {
    list-style: none;
    padding: 0;
    margin: 0;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
  }

  .sidebar-menu > li:not(.logout-item) {
    flex-shrink: 0;
  }

  .logout-item {
    margin-top: auto;
    flex-shrink: 0;
  }

  .main-content {
    transition: margin-left 0.3s, margin-bottom 0.3s;
  }

  @media (max-width: 768px) {
    .sidebar {
      width: 100%;
      height: auto;
      position: absolute;
      bottom: 0;
      left: 0;
      top: auto;
      transition: bottom 0.3s;
    }

    .sidebar-container.collapsed .sidebar {
      display: none;
    }

    .sidebar-container.expanded .sidebar {
      display: block;
    }

    .sidebar-container.expanded .sidebar-toggle::after {
      content: '✕';
    }

    .main-content {
      margin-bottom: 0;
    }

    .sidebar-container.expanded ~ .main-content {
      margin-bottom: 250px;
    }
  }

  @media (min-width: 769px) and (max-width: 1300px) {
    .sidebar-container.collapsed .sidebar {
      left: -250px;
    }

    .sidebar-container.expanded .sidebar {
      left: 0;
    }

    .main-content {
      margin-left: 0;
    }

    .sidebar-container.expanded ~ .main-content {
      margin-left: 250px;
    }
  }

  @media (min-width: 1301px) {
    .sidebar-container.collapsed .sidebar {
      left: -250px;
    }

    .sidebar-container.expanded .sidebar {
      left: 0;
    }

    .main-content {
      margin-left: 0;
    }

    .sidebar-container.expanded ~ .main-content {
      margin-left: 250px;
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const sidebarToggle = document.getElementById('sidebar-toggle');
    const sidebarContainer = document.querySelector('.sidebar-container');
    const mainContent = document.getElementById('main-content');
    const sidebar = document.getElementById('sidebar');

    if (sidebarToggle && sidebarContainer && mainContent && sidebar) {
      sidebarToggle.addEventListener('click', () => {
        sidebarContainer.classList.toggle('collapsed');
        sidebarContainer.classList.toggle('expanded');
        sidebar.classList.toggle('open');
        adjustContentMargin();
      });
    }

    window.addEventListener('resize', adjustContentMargin);

    function adjustContentMargin() {
      if (sidebarContainer && mainContent && sidebar) {
        if (window.innerWidth >= 1301 && sidebarContainer.classList.contains('expanded')) {
          mainContent.style.marginLeft = `${sidebar.offsetWidth}px`;
          mainContent.style.marginBottom = '0';
        } else if (window.innerWidth >= 769 && sidebarContainer.classList.contains('expanded')) {
          mainContent.style.marginLeft = '0';
          mainContent.style.marginBottom = `${sidebar.offsetHeight}px`;
        } else if (sidebarContainer.classList.contains('expanded')) {
          mainContent.style.marginLeft = '0';
          mainContent.style.marginBottom = `${sidebar.offsetHeight}px`;
        } else {
          mainContent.style.marginLeft = '0';
          mainContent.style.marginBottom = '0';
        }
      }
    }
  });
</script>
